apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflowTemplate
metadata:
  name: ragas-run-template
  namespace: {{ include "testbench.namespace" . }}
  labels:
    {{- include "testbench.labels" . | nindent 4 }}
    {{- include "testbench.workflowLabels" . | nindent 4 }}

spec:
  # Configuration parameters that can be overridden
  config:
    agentUrl:
      type: string
      description: "URL to the agent endpoint (A2A protocol)"
    otelExporterOtlpEndpoint:
      type: string
      description: "OTel Collector endpoint for exporting traces and metrics"
      default: "http://lgtm.monitoring:4318"

  # Steps to execute
  steps:
    - name: run
      artifacts:
        paths:
          - "data/experiments/ragas_experiment.jsonl"
      run:
        args:
          - run.py
          - "{{`{{ config.agentUrl }}`}}"
        env:
          - name: OTEL_EXPORTER_OTLP_ENDPOINT
            value: "{{`{{ config.otelExporterOtlpEndpoint }}`}}"
