apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflowTemplate
metadata:
  name: ragas-setup-template
  namespace: testkube
  labels:
    testkube.io/test-category: ragas-evaluation
    app: testworkflows

spec:
  # Configuration parameters that can be overridden
  config:
    datasetUrl:
      type: string
      description: "URL to the dataset file (.csv, .json, or .parquet)"
    image:
      type: string
      description: "Docker image to use for the setup step"
      default: "ghcr.io/agentic-layer/testbench/testworkflows:latest"

  # Steps to execute
  steps:
    - name: setup-dataset
      run:
        command:
          - sh
          - -c
        args:
          - |
            uv run python3 setup.py "{{ config.datasetUrl }}" && \
            if [ -f data/datasets/ragas_dataset.jsonl ]; then
              echo "✓ Dataset created: $(wc -l < data/datasets/ragas_dataset.jsonl) lines"
            else
              echo "✗ Error: Dataset file not created"
              exit 1
            fi