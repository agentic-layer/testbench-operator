apiVersion: v1
kind: ConfigMap
metadata:
  name: otelcol-config
  namespace: monitoring
data:
  lgtm-otelcol-config.yaml: |
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
            cors:
              allowed_origins:
                - http://*
      prometheus/testkube:
        config:
          scrape_configs:
            - job_name: "testkube-api"
              scrape_interval: 15s
              static_configs:
                - targets: ["testkube-api-server.testkube:8088"]
    
    extensions:
      health_check:
        endpoint: 0.0.0.0:13133
        path: "/ready"
    
    processors:
      batch:
    
    exporters:
      otlphttp/metrics:
        endpoint: http://127.0.0.1:9090/api/v1/otlp
        tls:
          insecure: true
      otlphttp/traces:
        endpoint: http://127.0.0.1:4418
        tls:
          insecure: true
      otlphttp/logs:
        endpoint: http://127.0.0.1:3100/otlp
        tls:
          insecure: true
      otlp/profiles:
        endpoint: http://127.0.0.1:4040
        tls:
          insecure: true
    
    service:
      extensions: [health_check]
      pipelines:
        traces:
          receivers: [otlp]
          processors: [batch]
          exporters: [otlphttp/traces]
          #exporters: [otlphttp/traces,debug/traces]
        metrics:
          receivers: [otlp, prometheus/testkube]
          processors: [batch]
          exporters: [otlphttp/metrics]
          #exporters: [otlphttp/metrics,debug/metrics]
        logs:
          receivers: [otlp]
          processors: [batch]
          exporters: [otlphttp/logs]
          #exporters: [otlphttp/logs,debug/logs]
        profiles:
          receivers: [otlp]
          exporters: [otlp/profiles]
